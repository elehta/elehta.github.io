<style>
    :root {
        --primary: #10b981;
        --secondary: #3b82f6;
        --dark: #1e293b;
        --light: #f8fafc;
        --border: #e2e8f0;
        --text: #334155;
        --mono: 'JetBrains Mono', 'Fira Code', monospace;
    }

    .dpp-container {
        font-family: 'Inter', system-ui, sans-serif;
        color: var(--text);
        max-width: 850px;
        margin: 20px auto;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: white;
        overflow: hidden;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* Top Identity Section */
    .dpp-id-bar {
        background: var(--dark);
        color: white;
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .id-tag {
        font-family: var(--mono);
        font-size: 0.75rem;
        background: rgba(255,255,255,0.1);
        padding: 4px 8px;
        border-radius: 4px;
        max-width: 250px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* Layout Columns */
    .dpp-main { display: flex; flex-wrap: wrap; border-bottom: 1px solid var(--border); }
    .dpp-media { flex: 1 1 300px; background: var(--light); padding: 20px; text-align: center; border-right: 1px solid var(--border); }
    .dpp-media img { max-width: 100%; border-radius: 8px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); }
    
    .dpp-info { flex: 2 1 400px; padding: 25px; }
    .dpp-info h1 { margin: 0 0 10px 0; font-size: 1.5rem; color: var(--dark); }

    /* Data Grid */
    .grid-pair { display: grid; grid-template-columns: 140px 1fr; gap: 10px; margin-bottom: 8px; font-size: 0.9rem; }
    .grid-label { color: #64748b; font-weight: 600; text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.025em; }
    .grid-value { font-weight: 500; }
    .nested-val { margin-left: 10px; padding-left: 10px; border-left: 2px solid var(--border); margin-top: 5px; }

    /* Tables & Cards */
    .section { padding: 20px; border-top: 1px solid var(--border); }
    .section-head { font-weight: 700; text-transform: uppercase; font-size: 0.8rem; margin-bottom: 15px; color: var(--secondary); display: flex; align-items: center; gap: 8px; }
    
    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    th { text-align: left; padding: 10px; background: var(--light); color: #64748b; }
    td { padding: 10px; border-bottom: 1px solid var(--border); }

    .score-row { display: flex; align-items: center; gap: 15px; margin-bottom: 12px; }
    .score-bar-bg { flex-grow: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
    .score-bar-fill { height: 100%; border-radius: 4px; }

    /* Utility Classes */
    .badge { padding: 3px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 700; color: white; }
    .bg-green { background: #10b981; }
    .bg-red { background: #ef4444; }
    .bg-amber { background: #f59e0b; }
    .link-alt { color: var(--secondary); text-decoration: none; font-weight: 600; }
    .link-alt:hover { text-decoration: underline; }

    .claim-box { background: var(--light); border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 15px; }
</style>

<div class="dpp-container">
    <div class="dpp-id-bar">
        <strong>DIGITAL PRODUCT PASSPORT</strong>
        <span class="id-tag" title="{{credentialSubject.id}}">{{credentialSubject.id}}</span>
    </div>

    <div class="dpp-main">
        <div class="dpp-media">
            {{#if credentialSubject.productImage.linkURL}}
                <img src="{{credentialSubject.productImage.linkURL}}" onerror="this.onerror=null;this.src='https://placehold.co/300x250';" alt="Product">
            {{else}}
                <img src="https://placehold.co/300x250" alt="Placeholder">
            {{/if}}
        </div>
        
        <div class="dpp-info">
            <h1>{{credentialSubject.name}}</h1>
            <div class="grid-pair">
                <span class="grid-label">Manufacturer</span>
                <span class="grid-value">{{credentialSubject.producedByParty.name}}</span>
            </div>
            <div class="grid-pair">
                <span class="grid-label">Location</span>
                <span class="grid-value">{{credentialSubject.producedAtFacility.name}} ({{credentialSubject.countryOfProduction}})</span>
            </div>
            <div class="grid-pair">
                <span class="grid-label">Description</span>
                <span class="grid-value">{{credentialSubject.description}}</span>
            </div>
            
            {{#if credentialSubject.batchNumber}}
            <div class="grid-pair">
                <span class="grid-label">Batch #</span>
                <span class="grid-value">{{credentialSubject.batchNumber}}</span>
            </div>
            {{/if}}
            
            {{#if credentialSubject.serialNumber}}
            <div class="grid-pair">
                <span class="grid-label">Serial #</span>
                <span class="grid-value">{{credentialSubject.serialNumber}}</span>
            </div>
            {{/if}}

            {{#if credentialSubject.productionDate}}
            <div class="grid-pair">
                <span class="grid-label">MFG Date</span>
                <span class="grid-value">{{credentialSubject.productionDate}}</span>
            </div>
            {{/if}}

            <div style="margin-top:15px;">
                <span class="grid-label">Dimensions</span>
                {{#each credentialSubject.dimensions}}
                <div class="nested-val">
                    <span style="text-transform: capitalize;">{{@key}}:</span> 
                    <strong>{{this.value}} {{this.unit}}</strong>
                </div>
                {{/each}}
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-head">Material Provenance</div>
        <table>
            <thead>
                <tr>
                    <th>Material</th>
                    <th>Mass</th>
                    <th>Recycled</th>
                    <th>Safety</th>
                    <th>Origin</th>
                </tr>
            </thead>
            <tbody>
                {{#each credentialSubject.materialsProvenance}}
                <tr>
                    <td><strong>{{name}}</strong></td>
                    <td>{{multiply massFraction 100}}% ({{massAmount.value}} {{massAmount.unit}})</td>
                    <td>{{multiply recycledAmount 100}}%</td>
                    <td>
                        {{#if (lookup . 'hazardous')}}
                            {{#if hazardous}}<span class="badge bg-red">HAZARDOUS</span>
                            {{else}}<span class="badge bg-green">SAFE</span>{{/if}}
                        {{else}}<span class="badge bg-amber">UNKNOWN</span>{{/if}}
                    </td>
                    <td>{{originCountry}}</td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>

    {{#if credentialSubject.circularityScorecard}}
    <div class="section">
        <div class="section-head">Circularity Scorecard</div>
        {{#if credentialSubject.circularityScorecard.recycledContent}}
        <div class="score-row">
            <span class="grid-label" style="width:140px">Recycled Content</span>
            <div class="score-bar-bg"><div class="score-bar-fill bg-green" style="width: {{multiply credentialSubject.circularityScorecard.recycledContent 100}}%"></div></div>
            <span class="grid-value">{{multiply credentialSubject.circularityScorecard.recycledContent 100}}%</span>
        </div>
        {{/if}}
        
        {{#if credentialSubject.circularityScorecard.recyclableContent}}
        <div class="score-row">
            <span class="grid-label" style="width:140px">Recyclable Content</span>
            <div class="score-bar-bg"><div class="score-bar-fill bg-amber" style="width: {{multiply credentialSubject.circularityScorecard.recyclableContent 100}}%"></div></div>
            <span class="grid-value">{{multiply credentialSubject.circularityScorecard.recyclableContent 100}}%</span>
        </div>
        {{/if}}

        {{#if credentialSubject.circularityScorecard.materialCircularityIndicator}}
        <div class="score-row">
            <span class="grid-label" style="width:140px">Circularity Index</span>
            <div class="score-bar-bg"><div class="score-bar-fill bg-green" style="width: {{multiply credentialSubject.circularityScorecard.materialCircularityIndicator 100}}%"></div></div>
            <span class="grid-value">{{multiply credentialSubject.circularityScorecard.materialCircularityIndicator 100}}%</span>
        </div>
        {{/if}}

        {{#if credentialSubject.circularityScorecard.utilityFactor}}
        <div class="grid-pair">
            <span class="grid-label">Utility Factor</span>
            <span class="grid-value">{{credentialSubject.circularityScorecard.utilityFactor}}</span>
        </div>
        {{/if}}
    </div>
    {{/if}}

    <div class="section">
        <div class="section-head">Product Lifecycle</div>
        <div class="grid-pair">
            <span class="grid-label">Recycling Info</span>
            <span class="grid-value"><a href="https://example.com/Recycling_information.pdf" target="_blank" class="link-alt">Recycling_information.pdf ↗</a></span>
        </div>
        <div class="grid-pair">
            <span class="grid-label">Repair Info</span>
            <span class="grid-value"><a href="https://example.com/Repair_information.pdf" target="_blank" class="link-alt">Repair_guide.pdf ↗</a></span>
        </div>
    </div>

    {{#if credentialSubject.emissionsScorecard}}
    <div class="section" style="background: var(--light);">
        <div class="section-head">Emissions Scorecard</div>
        {{#if credentialSubject.emissionsScorecard.carbonFootprint}}
        <div class="grid-pair">
            <span class="grid-label">Carbon Footprint</span>
            <span class="grid-value" style="font-size: 1.2rem;">{{credentialSubject.emissionsScorecard.carbonFootprint}} <small>kg CO2e / {{credentialSubject.emissionsScorecard.declaredUnit}}</small></span>
        </div>
        {{/if}}
        
        {{#if credentialSubject.emissionsScorecard.primarySourcedRatio}}
        <div class="score-row">
            <span class="grid-label" style="width:140px">Primary Data Ratio</span>
            <div class="score-bar-bg"><div class="score-bar-fill bg-amber" style="width: {{multiply credentialSubject.emissionsScorecard.primarySourcedRatio 100}}%"></div></div>
            <span class="grid-value">{{multiply credentialSubject.emissionsScorecard.primarySourcedRatio 100}}%</span>
        </div>
        {{/if}}

        {{#if credentialSubject.emissionsScorecard.reportingStandard}}
        <div class="grid-pair" style="margin-top:10px">
            <span class="grid-label">Standard</span>
            <span class="grid-value"><a href="{{credentialSubject.emissionsScorecard.reportingStandard.id}}" class="link-alt">{{credentialSubject.emissionsScorecard.reportingStandard.name}} ({{credentialSubject.emissionsScorecard.reportingStandard.issueDate}})</a></span>
        </div>
        {{/if}}
    </div>
    {{/if}}

    {{#if credentialSubject.conformityClaim}}
    <div class="section">
        <div class="section-head">Conformity Declarations</div>
        {{#each credentialSubject.conformityClaim}}
        <div class="claim-box">
            <div style="display:flex; justify-content: space-between; margin-bottom:10px;">
                <div>
                    <div class="grid-label">{{conformityTopic}}</div>
                    <div style="font-weight:700;">{{referenceStandard.name}}</div>
                </div>
                {{#if conformance}}<span class="badge bg-green">CONFORMANT</span>{{else}}<span class="badge bg-red">NON-CONFORMANT</span>{{/if}}
            </div>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                {{#each declaredValue}}
                <div style="font-size:0.8rem; padding:8px; background:white; border-radius:4px;">
                    <div class="grid-label" style="color:var(--primary)">Declared</div>
                    <div>{{metricName}}: <strong>{{metricValue.value}} {{metricValue.unit}}</strong></div>
                    {{#if ../conformityEvidence.linkURL}}
                    <a href="{{../conformityEvidence.linkURL}}" class="link-alt" style="font-size:0.7rem;">{{#if ../conformityEvidence.linkName}}{{../conformityEvidence.linkName}}{{else}}Evidence{{/if}} ↗</a>
                    {{/if}}
                </div>
                {{/each}}

                {{#each assessmentCriteria}}
                    {{#each thresholdValue}}
                    <div style="font-size:0.8rem; padding:8px; background:white; border-radius:4px; border-left: 3px solid var(--secondary);">
                        <div class="grid-label" style="color:var(--secondary)">Threshold</div>
                        <div>{{metricName}}: <strong>{{metricValue.value}} {{metricValue.unit}}</strong></div>
                        {{#if ../id}}<a href="{{../id}}" class="link-alt" style="font-size:0.7rem;">Reference ↗</a>{{/if}}
                    </div>
                    {{/each}}
                {{/each}}
            </div>
        </div>
        {{/each}}
    </div>
    {{/if}}

    {{#if credentialSubject.traceabilityInformation}}
    <div class="section">
        <div class="section-head">Traceability Events</div>
        <div class="grid-pair">
            <span class="grid-label">Process</span>
            <span class="grid-value">{{credentialSubject.traceabilityInformation.valueChainProcess}}</span>
        </div>
        {{#if credentialSubject.traceabilityInformation.verifiedRatio}}
        <div class="score-row">
            <span class="grid-label" style="width:140px">Verified Ratio</span>
            <div class="score-bar-bg"><div class="score-bar-fill bg-green" style="width: {{multiply credentialSubject.traceabilityInformation.verifiedRatio 100}}%"></div></div>
            <span class="grid-value">{{multiply credentialSubject.traceabilityInformation.verifiedRatio 100}}%</span>
        </div>
        {{/if}}
        
        <table style="margin-top:10px;">
            <thead><tr><th>Event Name</th><th style="text-align:right">Action</th></tr></thead>
            <tbody>
                {{#each credentialSubject.traceabilityInformation.traceabilityEvent}}
                <tr>
                    <td>{{linkName}}</td>
                    <td style="text-align:right"><a href="{{linkURL}}" class="link-alt">View Event ↗</a></td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
    {{/if}}
</div>
