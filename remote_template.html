<!DOCTYPE html>
<html>
<head>
    <style>
        .dpp-container { font-family: sans-serif; border: 2px solid #000; padding: 20px; border-radius: 10px; background:#f6f6f6; max-width: 640px; font-size: 12px }
        .highlight { color: #007bff; font-weight: bold; }
        .sub-section-header { font-size: 1.2em; text-decoration: underline; }
        .data-box { background: #f3f3f3; padding: 10px; margin: 10px 0; border-left: 5px solid #007bff; }

        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }

        h1 { color: #2c3e50; margin-top: 0; }
        details { border: 1px solid #ddd; margin-bottom: 10px; border-radius: 4px; transition: all 0.3s; }
        summary { padding: 12px; font-weight: bold; cursor: pointer; background: #c3bfa6; outline: none; color: #818181; }
        details[open] summary { background: #c3bfa6; color: #f2f2f2; }
        .details-content { padding: 15px; line-height: 1.6; }
        
        .dpp-table { width: 100%; border-collapse: collapse; }
        .dpp-table th, .dpp-table td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
        .event-card { background: #f9f9f9; padding: 10px; border-left: 4px solid #007bff; margin-top: 10px; }
        /* Target the first column of the DPP table */
        .dpp-table tr th:first-child, .dpp-table tr td:first-child { width: 30%; min-width: 120px; /* Prevents the label from getting too squashed on mobile */ word-wrap: break-word; }
        /* Ensure the second column takes up the rest */
        .dpp-table tr td:last-child { width: 70%; }
        .product-main-img { width: 100%; max-width: 200px; height: auto; border-radius: 8px; border: 1px solid #ddd; display: block; margin: 10px 0; object-fit: cover; /* Keeps the image from stretching */ }
        .dimension-row { display: flex; gap: 10px; /* Space between label, value, and unit */ }
        .dimension-row span:first-child { min-width: 80px; /* Aligns all the labels (weight, volume) to the same width */  color: #555; }
    </style>
    
    <title>DPP | {{credentialSubject.name}}</title>
</head>
    
<body>
  <div class="dpp-container">
    {{#if credentialSubject}}
    <div class="dpp-wrapper">
    <header>
      <h3>DIGITAL PRODUCT PASSPORT</h3>  
      <h1>{{credentialSubject.name}}</h1>
    </header>

    <div class="product-image-container">
        {{#if credentialSubject.productImage.linkURL}}
            <img src="{{credentialSubject.productImage.linkURL}}" 
                 onerror="this.onerror=null;this.src='https://placehold.co/200x150';" 
                 alt="Product Image" 
                 class="product-main-img">
        {{else}}
            <img src="https://placehold.co/200x150" 
             alt="Placeholder" 
             class="product-main-img">
        {{/if}}
    </div>

    <details open>
      <summary>Product Specifications</summary>
      <div class="details-content">
        <table class="dpp-table">
          <tr>
            <th style="vertical-align: top;">Description</th>
            <td>{{credentialSubject.description}}</td>
          </tr>          
          <tr>
            <th>Manufacturer</th>
            <td>{{credentialSubject.producedByParty.name}}</td>
          </tr>
          <tr>
            <th>Location</th>
            <td>{{credentialSubject.producedAtFacility.name}} ({{credentialSubject.countryOfProduction}})</td>
          </tr>            
          <tr>
            <th>Batch Number</th>
            <td>{{credentialSubject.batchNumber}}</td>
          </tr>  
          <tr>          
              <th>Production Date</th>
            <td>{{credentialSubject.productionDate}}</td>
          </tr>       
          <tr>
            <th style="vertical-align: top; width: 30%;">Dimensions</th>
            <td>
              {{#each credentialSubject.dimensions}}
                <div class="dimension-row" style="margin-bottom: 5px;">
                  <span style="text-transform: capitalize;">{{@key}}:</span> 
                  <strong>{{this.value}}</strong> 
                  <span>{{this.unit}}</span>
                </div>
              {{/each}}
            </td>
          </tr>
        
        </table>
      </div>
    </details>

        <details open>
            <summary>Material Provenance</summary>
            <div class="details-content">
                <table class="dpp-table">
                    {{#each credentialSubject.materialsProvenance}}
                      <tr>          
                        <th>Material</th>
                        <td>{{this.name}}</td>
                      </tr> 
                      <tr>          
                        <th>Material</th>
                        <td>{{this.name}}</td>
                      </tr>
                      <tr>          
                        <th>Mass fraction</th>
                            <td>{{this.massFraction}}</td>
                      </tr>                     
                      <tr>          
                        <th>Recycled amount</th>
                        <td>{{this.recycledAmount}}</td>
                      </tr>                     
                      <tr>          
                        <th>Material type</th>
                        <td>{{this.materialType.name}}</td>
                      </tr> 

                        
                    {{/each}}
                </table>
            </div>
        </details>

    {{#if credentialSubject.circularityScorecard}}
        <details open>
            <summary>Circularity Scorecard</summary>
            <div class="details-content">
                <table class="dpp-table">
                    {{#each credentialSubject.circularityScorecard}}
                        <tr>
                            <th>{{@key}}</th>
                            <td>
                                {{this}}
                            </td>
                        </tr>
                    {{/each}}                   
                </table>
            </div>
        </details>
       {{/if}}
            

    <details open>
      <summary>Traceability Events</summary>
      <div class="details-content">
        <p><strong>Process:</strong> {{credentialSubject.traceabilityInformation.valueChainProcess}}</p>
        
        {{#each credentialSubject.traceabilityInformation.traceabilityEvent}}
        <div class="event-card">
          <strong>{{linkName}}</strong><br>
          <a href="{{linkURL}}" target="_blank">View External Resource</a>
        </div>
        {{/each}}
      </div>
    </details>
</div>

            <h2>{{credentialSubject.name}}</h2>
        <p>{{credentialSubject.description}}</p>


    
        <div class="data-box">
            <p><strong>Manufacturer:</strong> {{credentialSubject.producedByParty.name}}</p>
            <p><strong>Production Date:</strong> {{credentialSubject.productionDate}}</p>
            <p><strong>serialNumber:</strong> {{credentialSubject.serialNumber}}</p>
            <p><strong>batch:</strong> {{credentialSubject.batchNumber}}</p>
            <p><strong>Production platz:</strong> {{credentialSubject.producedAtFacility.name}}</p>
            <p><strong>Facility id:</strong> {{credentialSubject.producedAtFacility.id}}</p>    
            <p><strong>countryOfProduction:</strong> {{credentialSubject.countryOfProduction}}</p>
        </div>

        {{#each credentialSubject.productCategory}}
            <p><strong>Code:</strong> {{this.code}} {{this.name}}</p>
            <p><strong>Scheme:</strong> {{this.schemeName}}</p>                
        {{/each}}
        <p></p>
        {{#each credentialSubject.materialsProvenance}}
            <a href="{{this.materialType.id}}" style="display:inline-block; padding:10px; background:#28a745; color:white; text-decoration:none; border-radius:5px;">
                Link: {{this.materialType.name}}
            </a>
            <p><strong>Name:</strong> {{this.materialType.name}}</p>
        {{/each}}

        {{#if credentialSubject.circularityScorecard}}
        <p class="sub-section-header">Circularity Scorecard: </p>
            {{#if credentialSubject.circularityScorecard.recycledContent}}
                <p><strong>recyclableContent:</strong> {{credentialSubject.circularityScorecard.recycledContent}}</p>
            {{/if}}
            {{#if credentialSubject.circularityScorecard.recyclableContent}}
                <p><strong>recyclableContent:</strong> {{credentialSubject.circularityScorecard.recyclableContent}}</p>
            {{/if}}
        {{/if}}
        
        {{#each credentialSubject.traceabilityInformation.traceabilityEvent}}
            <table class="dpp-table nested-table">
                <tbody>
                    {{#each this}}
                    <tr>
                        <th>{{@key}}</th>
                        <td>
                            {{this}}
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        {{/each}}
    
    <hr>
    <div style="font-size: 10px; color: #666;">
        <p><strong>Issuer:</strong> {{issuer.name}} ()</p>
    </div>
    
    {{else}}
        <p style="color:red;">Error: credentialSubject data not found in the provided context.</p>
    {{/if}}
</div>
</div>
</body>
</html>
