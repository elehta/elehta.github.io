<style>
    :root {
        --terminal-bg: #0a0c10;
        --panel-bg: #141820;
        --accent: #00f2ff;
        --accent-dim: rgba(0, 242, 255, 0.15);
        --text: #c9d1d9;
        --dim: #6e7681;
        --border: #30363d;
        --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
    }

    .dpp-app-shell {
        max-width: 1200px;
        height: 750px; /* Fixed height to break the "document" feel */
        margin: 20px auto;
        background: var(--terminal-bg);
        color: var(--text);
        font-family: var(--font-mono);
        display: grid;
        grid-template-areas: 
            "head head head"
            "nav main stats"
            "foot foot foot";
        grid-template-columns: 280px 1fr 300px;
        grid-template-rows: 60px 1fr 50px;
        border: 1px solid var(--border);
        gap: 1px;
        background-color: var(--border); /* Creates grid lines */
    }

    /* HEADER: System Bar */
    .app-header {
        grid-area: head;
        background: var(--terminal-bg);
        display: flex;
        align-items: center;
        padding: 0 20px;
        justify-content: space-between;
        font-size: 0.8rem;
    }
    .system-status { color: #238636; }
    .system-status::before { content: "‚óè"; margin-right: 8px; animation: pulse 2s infinite; }

    /* NAV: Identity & Media */
    .app-nav {
        grid-area: nav;
        background: var(--panel-bg);
        padding: 20px;
        display: flex;
        flex-direction: column;
    }
    .img-frame {
        width: 100%;
        aspect-ratio: 1;
        border: 1px solid var(--border);
        margin-bottom: 20px;
        background-size: cover;
        background-position: center;
    }

    /* MAIN: Data Matrix */
    .app-main {
        grid-area: main;
        background: var(--terminal-bg);
        padding: 0;
        overflow-y: auto;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1px;
        background-color: var(--border);
    }

    .widget { background: var(--panel-bg); padding: 15px; }
    .widget-h { 
        font-size: 0.65rem; 
        color: var(--accent); 
        text-transform: uppercase; 
        margin-bottom: 12px;
        border-bottom: 1px solid var(--accent-dim);
        padding-bottom: 4px;
    }

    /* STATS: Compliance & Carbon */
    .app-stats {
        grid-area: stats;
        background: var(--panel-bg);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* UI Components */
    .data-row { display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 6px; }
    .label { color: var(--dim); }
    
    .carbon-gauge {
        background: var(--bg-inset);
        padding: 20px;
        text-align: center;
        border: 1px solid var(--border);
    }
    .big-num { font-size: 2.5rem; display: block; color: #fff; }

    .status-tag {
        font-size: 0.6rem;
        padding: 2px 4px;
        border: 1px solid currentColor;
    }

    /* Compliance List */
    .compliance-item {
        font-size: 0.7rem;
        padding: 10px;
        background: var(--terminal-bg);
        border-left: 2px solid var(--accent);
        margin-bottom: 8px;
    }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

    /* Custom Scrollbar */
    .app-main::-webkit-scrollbar { width: 4px; }
    .app-main::-webkit-scrollbar-thumb { background: var(--border); }
</style>

<div class="dpp-app-shell">
    <header class="app-header">
        <div><span class="system-status">DPP_CORE_V3.0 // EXPORT_MODE</span></div>
        <div style="color: var(--accent)">UUID: {{credentialSubject.id}}</div>
    </header>

    <nav class="app-nav">
        <div class="img-frame" style="background-image: url('{{credentialSubject.productImage.linkURL}}'), url('https://placehold.co/300?text=NO_SIGNAL');"></div>
        <div class="widget-h">Entity_Profile</div>
        <h2 style="margin:0; font-size: 1.1rem; color: #fff;">{{credentialSubject.name}}</h2>
        <div style="color:var(--accent); font-size: 0.8rem; margin-bottom: 15px;">{{credentialSubject.producedByParty.name}}</div>
        
        <div class="widget-h">Dimensions</div>
        {{#each credentialSubject.dimensions}}
        <div class="data-row">
            <span class="label">[{{@key}}]</span>
            <span>{{this.value}} {{this.unit}}</span>
        </div>
        {{/each}}
    </nav>

    <main class="app-main">
        <div class="widget" style="grid-column: span 2;">
            <div class="widget-h">Material_Provenance_Matrix</div>
            <table style="width:100%; font-size: 0.7rem; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; color: var(--dim);">
                        <th>SUBSTANCE</th>
                        <th>MASS</th>
                        <th>RECYCLED</th>
                        <th>ORIGIN</th>
                        <th>HAZMAT</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each credentialSubject.materialsProvenance}}
                    <tr style="border-top: 1px solid var(--border);">
                        <td style="padding: 8px 0;">{{name}}</td>
                        <td>{{multiply massFraction 100}}%</td>
                        <td>{{multiply recycledAmount 100}}%</td>
                        <td>{{originCountry}}</td>
                        <td>
                            {{#if (lookup . 'hazardous')}}
                                {{#if hazardous}}<span style="color:var(--danger)">[TRUE]</span>{{else}}<span style="color:var(--success)">[FALSE]</span>{{/if}}
                            {{else}}<span style="color:var(--dim)">[NULL]</span>{{/if}}
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>

        <div class="widget">
            <div class="widget-h">Logistics_Metadata</div>
            <div class="data-row"><span class="label">SITE</span><span>{{credentialSubject.producedAtFacility.name}}</span></div>
            <div class="data-row"><span class="label">BATCH</span><span>{{credentialSubject.batchNumber}}</span></div>
            <div class="data-row"><span class="label">MFG_DT</span><span>{{credentialSubject.productionDate}}</span></div>
        </div>

        <div class="widget">
            <div class="widget-h">Circularity_Indices</div>
            {{#if credentialSubject.circularityScorecard.recycledContent}}
                <div class="data-row"><span class="label">RCY_CONTENT</span><span>{{multiply credentialSubject.circularityScorecard.recycledContent 100}}%</span></div>
            {{/if}}
            {{#if credentialSubject.circularityScorecard.materialCircularityIndicator}}
                <div class="data-row"><span class="label">CIRC_INDEX</span><span>{{multiply credentialSubject.circularityScorecard.materialCircularityIndicator 100}}%</span></div>
            {{/if}}
            <div class="data-row"><span class="label">UTIL_FACTOR</span><span>{{credentialSubject.circularityScorecard.utilityFactor}}</span></div>
        </div>

        <div class="widget" style="grid-column: span 2;">
            <div class="widget-h">Conformity_Certification_Logs</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                {{#each credentialSubject.conformityClaim}}
                <div class="compliance-item">
                    <div style="display:flex; justify-content:space-between; margin-bottom: 5px;">
                        <span style="color:var(--accent)">{{referenceStandard.name}}</span>
                        <span>{{#if conformance}}[PASS]{{else}}[FAIL]{{/if}}</span>
                    </div>
                    {{#each declaredValue}}
                    <div style="font-size: 0.6rem; color: var(--dim);">METRIC: {{metricName}} ({{metricValue.value}} {{metricValue.unit}})</div>
                    {{/each}}
                    {{#each assessmentCriteria}}
                        {{#each thresholdValue}}
                        <div style="font-size: 0.6rem; color: #f87171;">LIMIT: {{metricName}} ({{metricValue.value}} {{metricValue.unit}})</div>
                        {{/each}}
                    {{/each}}
                </div>
                {{/each}}
            </div>
        </div>
    </main>

    <aside class="app-stats">
        <div class="widget-h">Carbon_Telemetry</div>
        <div class="carbon-gauge">
            <span class="label">EMISSIONS_INDEX</span>
            <span class="big-num">{{credentialSubject.emissionsScorecard.carbonFootprint}}</span>
            <span style="font-size: 0.6rem;">KG CO2E / {{credentialSubject.emissionsScorecard.declaredUnit}}</span>
        </div>

        <div class="widget-h">Traceability_Chain</div>
        <div style="font-size: 0.75rem;">
            <div style="color:var(--accent); margin-bottom: 5px;">CURRENT_STEP: {{credentialSubject.traceabilityInformation.valueChainProcess}}</div>
            <div class="data-row"><span class="label">VERIFIED_RATIO</span><span>{{multiply credentialSubject.traceabilityInformation.verifiedRatio 100}}%</span></div>
            {{#each credentialSubject.traceabilityInformation.traceabilityEvent}}
            <div style="margin-top:10px; border: 1px solid var(--border); padding: 5px;">
                <a href="{{linkURL}}" style="color:var(--text); text-decoration: none; font-size: 0.65rem;">> EXEC_EVENT: {{linkName}}</a>
            </div>
            {{/each}}
        </div>
    </aside>

    <footer class="app-header" style="grid-area: foot; border-top: 1px solid var(--border);">
        <div style="display:flex; gap: 20px;">
            <a href="https://example.com/Repair_information.pdf" style="color:var(--accent); text-decoration:none;">[REPAIR_MANUAL]</a>
            <a href="https://example.com/Recycling_information.pdf" style="color:var(--accent); text-decoration:none;">[RECYCLING_INF]</a>
        </div>
        <div style="color: var(--dim);">SESSION_ID: {{multiply credentialSubject.circularityScorecard.utilityFactor 1024}}</div>
    </footer>
</div>
