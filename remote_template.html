<!DOCTYPE html>
<html>
<head>
    <style>
        .dpp-container { font-family: sans-serif; border: 2px solid #000; padding: 20px; border-radius: 10px; background:#f6f6f6; max-width: 640px; font-size: 12px }
        .highlight { color: #007bff; font-weight: bold; }
        .sub-section-header { font-size: 1.2em; text-decoration: underline; }
        .data-box { background: #f3f3f3; padding: 10px; margin: 10px 0; border-left: 5px solid #007bff; }
        .dpp-table { width: 100%; border-collapse: collapse;  margin-top: 20px; font-family: sans-serif; }
        .dpp-table th, .dpp-table td { border: 1px solid #ddd;  padding: 12px; text-align: left; }
        .dpp-table th { background-color: #f8f9fa; width: 30%; color: #333; }
        .nested-table { width: 100%; background-color: #fafafa; margin: 5px 0; }
    </style>
    <title>DPP | {{credentialSubject.name}}</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
              (function() {
    const container = document.getElementById('flag-container');
    const code = container.innerText.trim().toUpperCase();
    
    if (code.length === 2) {
      // Magic formula to turn ISO codes into Emojis
      const emoji = code.replace(/./g, char => 
        String.fromCodePoint(char.charCodeAt(0) + 127397)
      );
      container.innerHTML = emoji + " (" + code + ")";
    }
  })();
        });
    </script>
</head>
    
<body>
    
<script>
  (function() {
    const container = document.getElementById('flag-container');
    const code = container.innerText.trim().toUpperCase();
    
    if (code.length === 2) {
      // Magic formula to turn ISO codes into Emojis
      const emoji = code.replace(/./g, char => 
        String.fromCodePoint(char.charCodeAt(0) + 127397)
      );
      container.innerHTML = emoji + " (" + code + ")";
    }
  })();
</script>
    
<div class="dpp-container">
    {{#if credentialSubject}}
        <h2>{{credentialSubject.name}}</h2>
        <p>{{credentialSubject.description}}</p>
        
        <div class="data-box">
            <p><strong>Manufacturer:</strong> {{credentialSubject.producedByParty.name}}</p>
            <p><strong>Production Date:</strong> {{credentialSubject.productionDate}}</p>
            <p><strong>serialNumber:</strong> {{credentialSubject.serialNumber}}</p>
            <p><strong>batch:</strong> {{credentialSubject.batchNumber}}</p>
            <p><strong>Production platz:</strong> {{credentialSubject.producedAtFacility.name}}</p>
            <p><strong>Facility id:</strong> {{credentialSubject.producedAtFacility.id}}</p>    
            <p><strong>countryOfProduction:</strong> {{credentialSubject.countryOfProduction}} <span class="flag-container">{{credentialSubject.countryOfProduction}}</span></p>
        </div>

        {{#each credentialSubject.productCategory}}
            <p><strong>Code:</strong> {{this.code}} {{this.name}}</p>
            <p><strong>Scheme:</strong> {{this.schemeName}}</p>                
        {{/each}}
        <p></p>
        {{#each credentialSubject.materialsProvenance}}
            <a href="{{this.materialType.id}}" style="display:inline-block; padding:10px; background:#28a745; color:white; text-decoration:none; border-radius:5px;">
                Link: {{this.materialType.name}}
            </a>
            <p><strong>Name:</strong> {{this.materialType.name}}</p>
        {{/each}}

        {{#if credentialSubject.circularityScorecard}}
        <p class="sub-section-header">Circularity Scorecard: </p>
            {{#if credentialSubject.circularityScorecard.recycledContent}}
                <p><strong>recyclableContent:</strong> {{credentialSubject.circularityScorecard.recycledContent}}</p>
            {{/if}}
            {{#if credentialSubject.circularityScorecard.recyclableContent}}
                <p><strong>recyclableContent:</strong> {{credentialSubject.circularityScorecard.recyclableContent}}</p>
            {{/if}}
        {{/if}}
        
        {{#each credentialSubject.traceabilityInformation.traceabilityEvent}}
            <table class="dpp-table nested-table">
                <tbody>
                    {{#each this}}
                    <tr>
                        <th>{{@key}}</th>
                        <td>
                            {{this}}
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        {{/each}}
    
    {{else}}
        <p style="color:red;">Error: credentialSubject data not found in the provided context.</p>
    {{/if}}

    <hr>
    <div style="font-size: 10px; color: #666;">
        <p><strong>Issuer:</strong> {{issuer.name}} ()</p>
    </div>
</div>

</body>
</html>
